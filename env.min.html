<!doctype html>
<html>
  <head>
      <script src="https://cdn.jsdelivr.net/pyodide/v0.28.2/full/pyodide.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/polyscript" type="module"></script>
  </head>
  <body>
    <div id="msg">Loading...</div>
    <script type="text/javascript">
      async function main() {
        console.log("main enter");

        const pyodide = await loadPyodide();
        console.log("pyodide", pyodide);

        const micropip = await pyodide.loadPackage("micropip");
        //const micropip = pyodide.pyimport("micropip");
        console.log("micropip", micropip);

        let result = await pyodide.runPythonAsync(`
          print("runPythonAsync start", globals())
          import sys
          print("modules start", sorted(sys.modules.keys()))

          import micropip
          #print(micropip.list())

          g_var = 123
          def localfunc():
            l_var = 123
            print("locals", locals())

          localfunc()

          print("modules end", sorted(sys.modules.keys()))
          print("runPythonAsync exit", globals())
        `);

        console.log("main exit", result);
      }

      main();
    </script>
  </body>
</html>
